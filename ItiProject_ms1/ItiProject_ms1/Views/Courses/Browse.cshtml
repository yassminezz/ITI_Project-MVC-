@model ItiProject_ms1.Views.ViewModel.CrssDeptssViewModel

@{
    ViewData["Title"] = "Browse Courses";

    // Get joined courses from ViewBag
    var joinedCourses = ViewBag.JoinedCourses as List<int> ?? new List<int>();
}

<h1 class="mb-4">Available Courses</h1>

@if (TempData["Message"] != null)
{
    <div class="alert alert-info">@TempData["Message"]</div>
}

<div class="row">
    @foreach (var course in Model.courses)
    {
        var deptName = Model.departments.FirstOrDefault(d => d.Id == course.DeptId)?.Name ?? "Unknown";

        <div class="col-md-4 mb-4">
            <div class="card shadow-sm @(joinedCourses.Contains(course.Id) ? "border-success" : "")">
                <div class="card-body">
                    <h5 class="card-title">@course.Name</h5>
                    <p class="card-text">
                        <strong>Degree:</strong> @course.Degree <br />
                        <strong>Minimum Degree:</strong> @course.MinimumDegree <br />
                        <strong>Hours:</strong> @course.Hours <br />
                        <strong>Department:</strong> @deptName
                    </p>

                    @if (joinedCourses.Contains(course.Id))
                    {
                        <a asp-controller="Courses" asp-action="LeaveCourse" asp-route-courseId="@course.Id" class="btn btn-danger w-100">
                            Leave Course
                        </a>
                    }
                    else
                    {
                        <a asp-controller="Courses" asp-action="JoinCourse" asp-route-courseId="@course.Id" class="btn btn-primary w-100">
                            Join Course
                        </a>
                    }

                </div>
            </div>
        </div>
    }
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
}
